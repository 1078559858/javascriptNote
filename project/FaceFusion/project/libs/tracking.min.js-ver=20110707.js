!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("bbtTracking",[],t):"object"==typeof exports?exports.bbtTracking=t():e.bbtTracking=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(1);var i,r=n(2);var o=new((i=r)&&i.__esModule?i:{default:i}).default;t.default=o},function(e,t,n){"use strict";Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],r=0;r<n;){var o=t[r];if(e.call(i,o,r,t))return o;r++}},writable:!0,configurable:!0}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},writable:!0,configurable:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(3),a=(i=o)&&i.__esModule?i:{default:i},s=n(5);var u=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sender=new a.default,this.options={},this.start=Date.now(),window.addEventListener("click",function(e){window.console.log("tracking delegate click",e);var n=t.getOptions(t.getTarget(e));0!==Object.keys(n).length&&t.send(Object.assign(n,{an:2}))},!0);var n=function(){t.flush({an:9,ad:Date.now()-t.start})};/^Mozilla\/5\.0 \((?:iPad|iPhone); /.test(navigator.userAgent)?window.addEventListener("pagehide",n,!1):window.addEventListener("beforeunload",n,!1)}return r(e,[{key:"setPageInfo",value:function(e){var t=e.pi,n=e.pt,i=e.pv;if(n&&i&&!t?t=n+"_"+i:!n||i||t?!t||n||i||(n=t):t=n,!t)throw new Error("pi必须存在");this.options=Object.assign({},this.options,{pi:String(t),pt:String(n||""),pv:String(i||""),url:String(location.href)})}},{key:"getPageInfo",value:function(e){var t=e.pi,n=e.pt,i=e.pv;if(n&&i&&!t?t=n+"_"+i:!n||i||t?!t||n||i||(n=t):t=n,!t)throw new Error("pi必须存在");return{pi:String(t),pt:String(n||""),pv:String(i||""),url:String(location.href)}}},{key:"setRefererPageInfo",value:function(e){this.options=Object.assign({},this.options,{rp:String(e.pi||""),rt:String(e.pt||""),rf:String(e.pv||""),ru:String(e.url||"")})}},{key:"getRefererPageInfo",value:function(e){return{rp:String(e.rp||""),rt:String(e.rt||""),rf:String(e.rf||""),ru:String(document.referrer)}}},{key:"getNetInfo",value:function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection,t="unknown";if(!e)return t;if(e.type){if(t=e.type,/^\d+$/.test(t))switch(t){case e.ETHERNET:t="ETHERNET";break;case e.WIFI:t="WIFI";break;case e.CELL:t="2g";break;case e.CELL_2G:t="CELL_2G";break;case e.CELL_3G:t="CELL_3G";break;case e.CELL_4G:t="CELL_4G";break;default:t="UNKNOWN"}}else e.effectiveType&&(t=e.effectiveType);return(t=t.toLowerCase()).indexOf("wifi")>=0?t="1":t.indexOf("4g")>=0?t="2":t.indexOf("3g")>=0?t="3":t.indexOf("2g")>=0?t="5":t.indexOf("unknown")>=0&&(t="7"),t.toLowerCase()}},{key:"getDeviceInfo",value:function(){var e=(0,s.parse)(navigator.userAgent),t={android:1,ios:2}[e.os.toLowerCase()]||"";return{sr:String(navigator.userAgent),nt:String(this.getNetInfo()),os:String(t),ov:String(""),db:String(""),dm:String(""),br:String(e.browser),bv:String(e.version),dr:String(screen.width+"x"+screen.height)}}},{key:"getMetaInfo",value:function(){var e="";/(?:(?:;\s+)|^)__myutma=([\d.]+)/.test(document.cookie)&&(e=RegExp.$1.split(".")[1]||"");return{cookie:String(e),ti:String(Date.now()),px:String(21),ts:String(Date.now()),sv:String("0.1.0")}}},{key:"getData",value:function(e){var t=Object.assign({},this.options,e);return Object.assign({},this.getPageInfo(t),this.getRefererPageInfo(t),this.getDeviceInfo(),this.getMetaInfo(),t)}},{key:"init",value:function(e){this.setRefererPageInfo(this.options),this.setPageInfo(e),this.options=Object.assign({},this.options,e),this.send({an:1})}},{key:"send",value:function(e){var t=this.getData(e);this.sender.send(t)}},{key:"flush",value:function(e){var t=this.getData(e);this.sender.flush(t)}},{key:"getTarget",value:function(e){var t=e.target;for(t||(t=e.srcElement||document),3===t.nodeType&&(t=t.parentNode);!Object.keys(t.dataset).find(function(e){return e.indexOf("bbtTracking")>=0});)if((t=t.parentNode)===document){t=void 0;break}return t}},{key:"getOptions",value:function(e){if(!e)return{};var t=e.dataset;return["user_id","bb","ii","ps","po","ci","cs","cy","ct","an","ae","ce","sr","ap","ad"].map(function(e){var n="bbtTracking"+(e[0].toUpperCase()+e.slice(1));return{name:e,value:(t[n]||"").trim()}}).filter(function(e){return!!e.value}).reduce(function(e,t){return e[t.name]=t.value,e},{})}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(4),a=(i=o)&&i.__esModule?i:{default:i};var s=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.load=function(){t._send(),t.isSending=!1},this.error=function(){t._send(),t.isSending=!1},this.abort=function(){t._send(),t.isSending=!1},this.queue=new a.default,this.isSending=!1}return r(e,[{key:"addPageInfo",value:function(e){var t=e.pt,n=e.pv,i=e.pi;try{window.BIDataDriver_PageInformation&&window.BIDataDriver_PageInformation(t,n,i)}catch(e){window.console.log(e)}}},{key:"addTrack",value:function(e,t){if((window.track||window.BIDataDriver_HandleBIDataWithDictionary)&&e){["ti","sv","px","ts","la","lo","gl","nt","isConnected","sd","os","ov","db","dm","dr","ai","bu","pw","ch","mac","ud","imsi","pr","imei"].forEach(function(t){try{delete e[t]}catch(e){window.console.log(e)}});try{if(window.console.log("全埋点.msg:"+t+".data:"+this.stringify(e)),this.addPageInfo(e),window.track&&window.track.addTrackdata){var n=this.stringify(e);return window.track.addTrackdata(n),!0}if(void 0!==window.BIDataDriver_HandleBIDataWithDictionary)return window.BIDataDriver_HandleBIDataWithDictionary(JSON.parse(this.stringify(e))),!0}catch(e){window.console.log(e)}return!1}}},{key:"sendXhr",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.isSending=!0;var n=new XMLHttpRequest;n.addEventListener("load",this.load,!1),n.addEventListener("error",this.error,!1),n.addEventListener("abort",this.abort,!1),n.open("POST","//tracking.babytree.com/warlock-collector/service/T0003",t),n.setRequestHeader("Content-Type","text/plain"),window.console.log(e),n.send(this.stringify(e))}},{key:"getData",value:function(){for(var e=[];this.queue.peek();)e.push(this.queue.poll());return{head:{version:"0.1.0",appid:"BRS-0000-0005",sign:"fc35fdc70d5fc69d269883a822c7a53e"},body:{ja:e}}}},{key:"_send",value:function(){this.queue.size()&&!this.isSending&&this.sendXhr(this.getData())}},{key:"send",value:function(e){e&&(this.addTrack(e)||(this.queue.offer(e),this._send()))}},{key:"flush",value:function(e){e&&this.addTrack(e)||(e&&this.queue.offer(e),this.queue.size()&&(window.navigator.sendBeacon?window.navigator.sendBeacon("//tracking.babytree.com/warlock-collector/service/T0003",this.stringify(this.getData())):this.sendXhr(this.getData(),!1)))}},{key:"stringify",value:function(e){return JSON.stringify(e,function(e,t){return"number"==typeof t?String(t):""!==t&&t?t:void 0})}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collection=[]}return i(e,[{key:"size",value:function(){return this.collection.length}},{key:"offer",value:function(e){this.collection.push(e)}},{key:"poll",value:function(){return 0===this.size()?null:this.collection.shift()}},{key:"peek",value:function(){return 0===this.size()?null:this.collection[0]}}]),e}();t.default=r},function(e,t,n){(function(e){"use strict";e.parse=function(){var e={type:"Unknown",browser:"",engine:"",version:"",os:""},t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!t&&"undefined"!=typeof window&&window.navigator&&(t=window.navigator.userAgent),!t)return e;var n=t.toLowerCase();e.userAgent=t;var i,r,o,a=function(e){return e.test(n)},s=a(/chrome/i),u=a(/safari/i),c=a(/firefox/i),f=a(/vivaldi/i),l=a(/opera/i),d=a(/opera mini/i),p=a(/edge/),g=a(/msie/i),v=a(/midori/i),h=a(/maxthon/i),b=a(/netscape/i),w=a(/konqueror/i),y=a(/minefield/i),k=a(/omniweb/i),m=a(/ucbrowser/),S=a(/webkit/i),_=a(/gecko/i),O=a(/presto/i),x=a(/trident/i),E=a(/avant browser/i),I=a(/seamonkey/i),D=a(/deepnet/i),T=a(/dorothy/i),j=a(/fennec/i),P=a(/maemo/i);return e.type=function(){var e=void 0;switch(!0){case a(/(ipad|android(?!.*mobile))/i)||a(/\W(kindle|silk|tablet)\W/i):e="Tablet";break;case a(/(iphone|ipod|((?:android)?.*?mobile)|j2me|mobi|blackberry|nokia|maemo|mini)/i):e="Mobile";break;case a(/(bot|crawler|spider|slurp|seeker)/i):e="Bot";break;case a(/(fetcher|scan|valid|check|news|engine)/i):e="Util";break;default:e="Desktop"}return e}(),e.os=(o="","Bot"===e.type||"Util"===e.type?o:(a(/android/i)?o="Android":a(/(ipad|iphone|ipod)/i)?o="iOS":a(/(blackberry)/i)?o="BlackBerry":a(/(symbos|symbian|nokia|maemo)/i)?o="SymbianOS":a(/linux/i)?o="Linux":a(/mac/i)?o="Mac":a(/iemobile/i)?o="WindowsPhone":a(/win/i)?o=a(/windows nt/i)?"Windows NT":"Windows":a(/cros/i)&&(o="ChromeOS"),o)),e.browser=(r="","Bot"===e.type||"Util"===e.type?r:(!S||!s||v||f||p||m?y?r="Minefield":_&&c&&!j&&!P?r="Firefox":!S||!u||s||v||k||m||f||h||T?D?r="Deepnet Explorer":k?r="OmniWeb":m?r="UCBrowser":w?r="Konqueror":h?r="Maxthon":f?r="Vivaldi":v?r="Midori":d?(r="Opera Mini","Android"===e.os&&"Tablet"===e.type&&(e.type="Unknown")):l?r="Opera":p?r="Edge":E?r="Avant Browser":I?r="SeaMonkey":a(/iemobile/i)?r="IEMobile":!g||l||f?T?r="Dorothy Browser":j?r="Fennec":P?r="Maemo Browser":b&&(r="Netscape"):r="MSIE":r="Safari":r="Chrome",r||"SymbianOS"===e.os&&(r=a(/doris/i)?"Doris":a(/gobrowser/)?"GoBrowser":"Nokia Browser"),r)),e.engine=(i="","Bot"===e.type||"Util"===e.type?a(/google/i)?i=a(/image/i)?"Googlebot-Image":a(/feedfetcher/i)?"Feedfetcher-Google":a(/appengine/i)?"AppEngine-Google":"Googlebot":a(/bing/i)?i="Bingbot":a(/baidu/i)?i="BaiduSpider":a(/yandexbot/i)?i="YandexBot":a(/yandeximages/i)?i="YandexImages":a(/yahoo/i)?i=a(/yahooseeker/i)?"YahooSeeker":"Yahoo! Slurp":a(/soso/i)?i="Sosospider":a(/exabot/i)?i="Exabot":a(/sogou/i)?i="Sogou Spider":a(/newsgator/i)&&(i="NewsGator"):S?i="Webkit":_?i="Gecko":x?i="Trident":O&&(i="Presto"),i),e.version=function(){var t,i,r="Bot"===e.type||"Util"===e.type?e.engine:e.browser,o="";if(D)o=function(){for(var e="",t=n.split(";"),i=0;i<t.length;i++){var r=t[i];if(/deepnet explorer/.test(r)){e=r.replace(/[^0-9.]/gi,"");break}}return e}();else if("YahooSeeker"===r)o=n.split(" ")[0].replace("yahooseeker/","");else if(E||g)o=function(){for(var e="",t=n.split(";"),i=0;i<t.length;i++){var r=t[i];if(/msie/.test(r)){e=r.replace(/[^0-9.]/gi,"");break}}return e}();else if("Nokia Browser"===e.browser)i=n.split("symbianos/"),o=i[1]?parseFloat(i[1]):"";else if("GoBrowser"===e.browser)t=n.split("gobrowser/"),o=t[1]?parseFloat(t[1]):"";else{var a=r.toLowerCase(),s=a,u=n.replace(s,"________").split(" ");"safari"===a||T?a="version/":a+="/";for(var c=0;c<u.length;c++){var f=u[c].replace("________",s);if(-1!==f.indexOf(a)){var l=f.split("/");l.length>1&&(o=l[1]);break}}}return o.indexOf(";")&&(o=o.split(";")[0]),o}(),e},Object.defineProperty(e,"__esModule",{value:!0})})(t)}]).default});